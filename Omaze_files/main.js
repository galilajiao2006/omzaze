var Site={init:function(){$("body").removeClass("no-js");Site.customCheckboxes();Site.rotatingContent();Site.tabbedContent();Site.expandContent();Site.homepageCarousel();Site.adjustArrows();Site.firePopup();Site.twitterPopup();Site.autoFocus();Site.boxClose();Site.shareEmailValidation();Site.smoothJump();Site.pollSetup();Site.suggestionSetup();Site.signupValidation();Site.numericFields();Site.placeholderFields();if($('html').hasClass('oldie'))$('.post').filter(':last-child').addClass('last-child');},smoothJump:function(){$('.scrolljump').click(function(){if(location.pathname.replace(/^\//,'')==this.pathname.replace(/^\//,'')&&location.hostname==this.hostname){var $target=$(this.hash);$target=$target.length&&$target||$('[name='+ this.hash.slice(1)+']');if($target.length){var targetOffset=$target.offset().top;$('html,body').animate({scrollTop:targetOffset},1000);return false;}}});},twitterPopup:function(){$('.popupx').click(function(event){var width=575,height=400,left=($(window).width()- width)/2,top=($(window).height()- height)/2,url=this.href,opts='status=1'+',width='+ width+',height='+ height+',top='+ top+',left='+ left;window.open(url,'twitter',opts);return false;});},customCheckboxes:function(){var $checkboxes=$(document).find('input').filter(':checkbox'),$labels=$checkboxes.prev('label'),$fauxCheck=$('<div class="checkbox" />').prependTo($labels);$checkboxes.addClass('hide');$checkboxes.each(function(){var checkbox=$(this),label=$("label[for="+$(this).attr("id")+"]"),faux=$("label[for="+$(this).attr("id")+"] > div.checkbox");if(checkbox.attr('checked')){faux.addClass('checkbox-checked');}else{faux.removeClass('checkbox-checked');}});if($('html').hasClass('ie7')){$fauxCheck.on('click',function(){var $thisCheck=$(this).siblings('input');if($thisCheck.prop('checked')===true){$thisCheck.prop('checked',false);}else{$thisCheck.prop('checked',true);}});}
function toggle_check(){var faux=$("label[for="+$(this).attr("id")+"] > div.checkbox");if($(this).prop('checked')){faux.addClass('checkbox-checked');}else{faux.removeClass('checkbox-checked');}}
$checkboxes.click(toggle_check);},rotatingContent:function(){var $slideshow=$(document).find('.banner-slideshow'),interval=7000,transition=800,timer={};var fireSlides=function($target,$pagination,nr,index,clear){if($target){if(clear)clearTimeout(timer.go);var $slide=$target.eq(index),$rest=$target.not($slide),$image=$rest.not($slide).find('.box-sidepic'),$content=$rest.not($slide).find('.content');$pagination.removeClass('dotted-pagination-dot-current').eq(index).addClass('dotted-pagination-dot-current');index++;if(index>=nr)index=0;$rest.removeClass('current').css('z-index',2);$slide.addClass('current').css('z-index',1).fadeIn(transition);$image.animate({top:-352},transition,function(){$(this).css('top',0);});$content.animate({bottom:-352},transition,function(){$(this).css('bottom',0);});$rest.fadeOut(transition);timer.go=setTimeout(function(){fireSlides($target,$pagination,nr,index);},interval);}};$slideshow.each(function(){var $slides=$(this).find('.slide'),$pagination=$(this).find('.dotted-pagination-dot'),nr=$slides.length;$slides.hide();$slides.eq(0).show();$slides.css({position:'absolute',left:0,top:0});fireSlides($slides,$pagination,nr,0);$pagination.on('click',function(){var index=$(this).index('.dotted-pagination-dot');fireSlides($slides,$pagination,nr,index,true);$pagination.removeClass('dotted-pagination-dot-current');$(this).addClass('dotted-pagination-dot-current');});$slides.on('mouseenter',function(){clearTimeout(timer.go);});$slides.on('mouseleave',function(){var index=$slides.filter('.current').index();fireSlides($slides,$pagination,nr,index,true);});});},tabbedContent:function(){var $switchers=$(document).find('.tabs-switcher');$switchers.each(function(){var $btns=$(this).children('.tab-selector'),$tabs=$(this).siblings('.tab-content'),defaultIndex=$btns.filter('.selected').index();$tabs.addClass('hide');$tabs.eq(defaultIndex).removeClass('hide');$btns.on('click',function(){var index=$(this).index();$btns.removeClass('selected');$(this).addClass('selected');$tabs.addClass('hide');$tabs.eq(index).removeClass('hide');});});},expandContent:function(){var $expandBtn=$(document).find('.expand');$expandBtn.on('click',function(){var $contentH=$(this).siblings('.hide'),$contentS=$(this).siblings('.show'),$text=$(this).find('.text');$(this).toggleClass('less');if($(this).hasClass('less')){$text.text('Less');}else{$text.text('More');}
$contentH.toggleClass('show').toggleClass('hide').hide().show('slow');$contentS.toggleClass('show').hide('slow',function(){$(this).toggleClass('hide');});});},homepageCarousel:function(){var $slideshow=$(document).find('.slideshow-big'),interval=5000,transition=300,thumbHeight=125,visibleThumbs=3,timer={};var $images=$slideshow.find('.slideshow-big-img'),$thumbs=$slideshow.find('.slideshow-big-thumb'),$textBoxes=$slideshow.find('.slideshow-big-textbox'),$thumbsContainer=$slideshow.find('.slideshow-big-thumbscontainer'),totalNr=$images.length;$thumbs.each(function(i){var $thisEl=$(this);if(i===0&&totalNr<=4){$thisEl.addClass('last').addClass('slidable');}
if(i===1){$thisEl.addClass('first');}
if(i===2){$thisEl.addClass('second');}
if(i===3){$thisEl.addClass('third');}
if(i<visibleThumbs+2&&i>0){$thisEl.addClass('slidable');}
if(i===4){$thisEl.addClass('last');}
$thisEl.attr('data-nr',i).css({position:'absolute',top:i<visibleThumbs+1&&i>0?thumbHeight*(i-1):thumbHeight*visibleThumbs});});var changeSlide=function($el){$thumbs.off();var nr=$el.data('nr'),repeat=0;$el.hasClass('first')?repeat=1:null;$el.hasClass('second')?repeat=2:null;$el.hasClass('third')?repeat=3:null;var update=function(){$thumbs.removeClass('third').removeClass('second');var $first=$thumbs.filter('.first'),firstNr=$first.data('nr');if(totalNr>4){$first.removeClass('slidable');}
$first.removeClass('first');if(firstNr===totalNr-1){$thumbs.eq(0).addClass('first');$thumbs.eq(1).addClass('second');}else{$thumbs.eq(firstNr+1).addClass('first');$thumbs.eq(firstNr+2>totalNr-1?0:firstNr+2).addClass('second');}
var lastNr=$thumbs.filter('.last').data('nr');$thumbs.removeClass('last');if(lastNr===totalNr-1){$thumbs.eq(0).addClass('slidable').addClass('last').css('top',thumbHeight*visibleThumbs);$thumbs.eq(totalNr-1).addClass('third');}else{$thumbs.eq(lastNr+1).addClass('slidable').addClass('last').css('top',thumbHeight*visibleThumbs);$thumbs.eq(lastNr).addClass('third');}
if(repeat>2){activateClick();$thumbs.filter('.second').trigger('click');}else if(repeat>1){activateClick();$thumbs.filter('.first').trigger('click');}else{activateClick();$images.css('z-index',0).filter('.current').animate({'top':375},transition).end().eq(nr).css('z-index',1).animate({top:0},transition,function(){$images.filter('.current').css('top',-375).removeClass('current');$(this).addClass('current');});$textBoxes.animate({'bottom':-375},transition).eq(nr).animate({bottom:0},transition,function(){$textBoxes.filter('.current').removeClass('current');$(this).addClass('current');});}};var $slidable=$thumbsContainer.find('.slidable');$slidable.not('.last').stop(true,true).animate({top:'-='+ thumbHeight},transition/repeat,'linear').end().filter('.last').stop(true,true).animate({top:'-='+ thumbHeight},transition/repeat,'linear',function(){if($(this).hasClass('last')){update();}});};function activateClick(repeat){$thumbs.on('click',function(){changeSlide($(this));});};activateClick();function autoPlay(){clearInterval(timer.autoPlay);timer.autoPlay=setTimeout(function(){$thumbs.filter('.first').trigger('click');autoPlay();},interval);};autoPlay();$slideshow.on('mouseenter',function(){clearInterval(timer.autoPlay);}).on('mouseleave',function(){autoPlay();});},adjustArrows:function(){var $arrows=$(document).find('.slideshow-big-arrow');$(window).on('resize',function(){var width=$(this).width();if(width>=1200){$arrows.addClass('expanded');}else{$arrows.removeClass('expanded');}});$(window).trigger('resize');},firePopup:function(){var $activator=$('.popup-trigger'),$popup=$('.popup'),$overlay=$(document).find('.popup-overlay'),$close=$popup.find('.icon-popup-close');$activator.on('click',function(){$popup.add($overlay).fadeOut();var id=$(this).attr('href');$popup=$('.popup'+id);$popup.css({top:window.pageYOffset+ 100});var width=$(window).width(),height=$(window).height();$overlay.css({width:width,height:height});$popup.add($overlay).fadeIn();return false;});$overlay.add($close).on('click',function(){$popup.add($overlay).fadeOut();});},autoFocus:function(){if($('html').hasClass('ie7')){var inputs=$('input, textarea');inputs.focusin(function(){$(this).addClass('focus');}).focusout(function(){$(this).removeClass('focus');});}},boxClose:function(){$(".close-box").click(function(){$(".content-top-box").fadeOut();return false;});},pollSetup:function(){$(".trigger-vote").click(function(){var voteString=$(this).attr("data-vote");$.ajax({url:'/wp-content/themes/omaze/ajax-poll.php',type:'POST',data:{ballot:voteString},dataType:'json',success:function(response){$(".pick-box-list li").each(function(index){var percentage=(response['count'][index]/response['total'])*100;percentage=Math.round(percentage*10)/10;$(this).find(".poll-result").html(percentage+"%").show();$(this).find("a.trigger-vote").remove();});}});});},suggestionSetup:function(){$("#suggestion-text").keyup(function(event){if(event.keyCode=='13'){event.preventDefault();$(".trigger-suggestion").click();}});$(".trigger-suggestion").click(function(){$.ajax({url:'/wp-content/themes/omaze/ajax-suggestion.php',type:'POST',data:{suggestion:$("#suggestion-text").val(),type:$("#suggestion-type").val()}});$("#suggestion-content").html("<h3 class='feedback'>Thank you for your suggestion!</h3>");});},shareEmailValidation:function(){$('#share-popup form input[type=submit]').click(function(e){e.preventDefault();var form=$('#share-popup form'),sendTo=$('#share-popup form [name="email[]"]'),sendingTo=0,hasError=false,$el;$sender=$('[name=sender]',form);if(!$sender.val().valid_email())
{$sender.addClass('error');hasError=true;}
else
{$sender.removeClass('error');}
$message=$('[name=message]',form);if($message.val().length==0)
{$message.addClass('error');hasError=true;}
else
{$message.removeClass('error');}
for(i=0;i<sendTo.length;i++)
{var $el=$(sendTo[i]);if(i==0&&!$el.val().valid_email())
{$el.addClass('error');hasError=true;}
else
{$el.removeClass('error');sendingTo++;}}
if(sendingTo==0)
{hasError=false;}
if(!hasError)
{$.ajax({url:'/',type:'POST',dataType:'json',data:$('#share-popup form').serialize(),success:function(response){if(response.status=="fail"){$("#emailshare-error").addClass('error').html(response.message).show();errorMessage=response.message;}else{$("#emailshare-error").hide();$("#emailshare-success").html(response.message).show();}}});}});},signupValidation:function(){var signupEmailOk=true;var errorMessage=null;$("#signup-form #login-email").blur(function(){$.ajax({url:"/wp-content/themes/omaze/ajax-signup.php?action=email-exists&email="+ $(this).val(),dataType:'json',success:function(response){if(response.status=="fail"){$("#signup-form #login-email").addClass('error');$("#signup-error").html(response.message).show();signupEmailOk=false;errorMessage=response.message;}else{$("#signup-form #login-email").removeClass('error');$("#signup-error").hide();signupEmailOk=true;errorMessage=null;}}});});$("#signup-form").submit(function(){if($("#signup-form #login-email").val()==''){$("#signup-form #login-email").addClass('error');$("#signup-error").html("Email cannot be blank.").show();return false;}else{$("#signup-form #login-email").removeClass('error');$("#signup-error").hide();}
if($("#signup-form #login-pass").val()==''){$("#signup-form #login-pass").addClass('error');$("#signup-error").html("Password cannot be blank.").show();return false;}else{$("#signup-form #login-pass").removeClass('error');$("#signup-error").hide();}
if(!signupEmailOk){$("#signup-form #login-email").addClass('error');$("#signup-error").html(errorMessage).show();return false;}else{$("#signup-form #login-email").removeClass('error');$("#signup-error").hide();}
if($("#signup-form #login-pass").val()!=$("#signup-form #login-pass-confirm").val()){$("#signup-form #login-pass").addClass('error');$("#signup-form #login-pass-confirm").addClass('error');$("#signup-error").html("Passwords do not match.").show();return false;}else{$("#signup-form #login-pass").removeClass('error');$("#signup-form #login-pass-confirm").removeClass('error');$("#signup-error").hide();}
return true;});},numericFields:function(){$('input:text.numeric').keydown(function(event){if(event.keyCode==46||event.keyCode==8||event.keyCode==9||event.keyCode==27||event.keyCode==13||(event.keyCode==65&&event.ctrlKey===true)||(event.keyCode>=35&&event.keyCode<=39)){return;}
else{if(event.shiftKey||(event.keyCode<48||event.keyCode>57)&&(event.keyCode<96||event.keyCode>105)){event.preventDefault();}}});},placeholderFields:function(){$('input:text[data-placeholder],textarea[data-placeholder]').focus(function(){var s=$(this);if(s.is('.with-placeholder'))
s.removeClass('with-placeholder').val('');}).blur(function(){var s=$(this);if(!s.val()||s.val()==s.attr('data-placeholder'))
s.addClass('with-placeholder').val(s.attr('data-placeholder'));}).trigger('blur');$('form').submit(function(){$(this).find('input:text[data-placeholder].with-placeholder,textarea[data-placeholder].with-placeholder').val('');});}};$(document).ready(function(){Site.init();window.fb_post=function(url,action,object,message,campaign){var url,action,object,message,campaign;var token;var logged_in=null;var fb_login=function(){FB.login(function(response){if(response.authResponse){check_perms();}},{scope:'email,user_location,user_birthday, publish_stream'});};var logged_in=function(){FB.getLoginStatus(function(resp){if(resp.status==='connected'){token=resp.authResponse["accessToken"];check_perms();}
else{logged_in=1;fb_login();}});};var check_perms=function(){FB.api("/me/permissions",{access_token:token},function(resp){var perms=resp.data[0];if(perms.publish_stream){post(action,object,message);}
else{fb_login();}});};var post=function(action){if(url.indexOf("?")>=0){var sep="&";}else{var sep="?";}
url=url+ sep+"utm_source=facebook&utm_medium=social&utm_campaign="+ campaign;if(object==="dream_experience"){FB.api("/me/"+action,"post",{access_token:token,dream_experience:url},function(resp){if(!resp||resp.error){}
else{mixpanel.track("Social Activity",{"Platform":"Facebook","Action":action,"Campaign":campaign});mixpanel.people.increment("Facebook Posts");}});}else{FB.api("/me/"+action,"post",{access_token:token,object:url},function(resp){if(!resp||resp.error){}
else{mixpanel.track("Social Activity",{"Platform":"Facebook","Action":action,"Campaign":campaign});mixpanel.people.increment("Facebook Posts");}});}
if(logged_in){}};logged_in();};function fb_post_dialog(img,desc,title,url,campaign){FB.ui({method:"feed",link:url,picture:img,name:title,description:desc},function(resp){if(resp&&resp.post_id){mixpanel.track("Social Activity",{"Platform":"Facebook","Action":"Wall post","Campaign":campaign});mixpanel.people.increment("Facebook Posts");_gaq.push(["_trackEvent","Social Activity","Wall Post","Facebook"]);_gaq.push(['_trackSocial','facebook','wall post',url]);}});}
$(".fb-connect").click(function(e){e.preventDefault();FB.login(function(response){if(response.authResponse){window.location="/wp-content/themes/omaze/dynamic/fb.php?referrer="+ escape(window.location.href);}},{scope:'email,user_location,user_birthday'});});setTimeout(function(){$(".profile-page .woocommerce-message").fadeOut();},3000);$("a.the-video").click(function(){$("div.the-video").modal();mixpanel.track("Opened Video");var src=$('div.the-video iframe').attr('src')+'?autoplay=1';$('div.the-video iframe').attr('src',src);});if(typeof(twttr)!=="undefined"){twttr.ready(function(twttr){twttr.events.bind('tweet',function(intent_event){mixpanel.track("Social Activity",{"Platform":"Twitter","Action":"Tweet"});mixpanel.people.increment("Tweets");_gaq.push(["_trackEvent","Social Activity","Tweet","Twitter"]);trackTwitter;});twttr.events.bind('follow',function(intent_event){mixpanel.track("Social Activity",{"Platform":"Twitter","Action":"Follow"});_gaq.push(["_trackEvent","Social Activity","Follow","Twitter"]);_gaq.push(['_trackSocial','twitter','follow']);});});}
function extractParamFromUri(uri,paramName){if(!uri){return;}
var regex=new RegExp('[\\?&#]'+ paramName+'=([^&#]*)');var params=regex.exec(uri);if(params!=null){return unescape(params[1]);}
return;}
function trackTwitter(intent_event){if(intent_event){var opt_pagePath;if(intent_event.target&&intent_event.target.nodeName=='IFRAME'){opt_target=extractParamFromUri(intent_event.target.src,'url');}
_gaq.push(['_trackSocial','twitter','tweet',opt_pagePath]);}}
String.prototype.valid_email=function(){if(this.length==0){return false;}
if(!/^[^@]+@[^@.]+\.[^@]*\w\w$/.test(this)){return false;}
if(this=='email@email.com'){return false;}
return true;};$("input[name='quantity']").each(function(){$(this).click(function(){if($("#other-qty").prop("checked")){if($("#quantity input").length>0){$("#quantity input").focus();return;}
$("#quantity").html("<input type='text' placeholder='Enter number of tickets' id='qty-input' name='quantity' />");}
else{$("#quantity").html('<span class="label">20+ Tickets</span>');}});});$(".flash-message").fadeOut(3000);if(typeof(window.user_data)!="undefined"){mixpanel.people.set({$email:user_data["user_email"],$first_name:user_data["first_name"],$last_name:user_data["last_name"],$name:user_data["nickname"],$created:user_data["created"],"Gender":user_data["gender"],"Age":user_data["age"],$last_login:new Date(),"fb_id":user_data["fb_id"],"Initial Referring Domain":window.referring_domain});mixpanel.register({"email":user_data["user_email"],"age":user_data["age"],"gender":user_data["gender"],$born:user_data["created"],"fb_id":user_data["fb_id"]});}
function get_referral_info(channel,campaign,product_id){if(typeof(product_id)=="undefined"){var product_id=$("#product").data("id");}
return $.ajax({url:'/wp-content/themes/omaze/ajax-referral.php',type:'POST',data:{channel:channel,product_id:product_id,campaign:campaign},dataType:'json',success:function(response){$("#sharing-result").html("Thanks for sharing!");$("#sharing-result").addClass("success-message");},error:function(response){$("#sharing-result").html("We're sorry. Something went wrong. Please try again.");$("#sharing-result").addClass("fail-message");}});}
window.facebook_referral=function(campaign,product_id){var info=get_referral_info("facebook-post",campaign,product_id);info.success(function(data){fb_post_dialog(data["image"],data["desc"],data["title"],data["url"],campaign);});info.error(function(data){});}
function email_referral(campaign,product_id){if(product_id==null){var product_id=$("#product").data("id");}
var info=get_referral_info("email",campaign,product_id);info.success(function(data){url=data["url"];text=data["sharing_copy"];subject=data["sharing_subject"];$("#share-popup input[name=share_link]").val(url);$("#share-popup input[name=subject]").val(subject);$("#share-popup textarea[name=message]").html(text);var link=$("a.social-icon.email");if(!link.length){var link=$("#email-share-btn");}
link.attr("href","#share-popup");link.addClass("popup-trigger");Site.firePopup();link.trigger("click");});}
$("#facebook-share-btn").click(function(){if($(this).hasClass("popup-trigger")){return;}
else{if(window.location.pathname.substr(1)=="thank-you"){var campaign="share_the_love_thankyou";}
else{var campaign="referral_page";}
facebook_referral(campaign);}});$("#email-share-btn").click(function(event){event.preventDefault();if($(this).hasClass("popup-trigger")){return;}
else{if(window.location.pathname.substr(1)=="thank-you"){var campaign="share_the_love_thankyou";}
else{var campaign="share_the_love"}
email_referral(campaign);}});$("#fb-link, .facebook.social-icon").click(function(event){event.preventDefault();if($(this).hasClass("popup-trigger")){return;}
else{if(window.location.pathname.substr(1)=="thank-you"){var campaign="share_the_love_thankyou";}
else{var campaign="share_the_love"}
facebook_referral(campaign,window.post_id);}});$("#twitter-link, .twitter.social-icon, #twitter-share-btn,.icon.social.twitter").click(function(event){event.preventDefault();if($(this).hasClass("popup-trigger")){return;}
else{if(window.location.pathname.substr(1)=="thank-you"){var campaign="share_the_love_thankyou";}
else if(window.location.pathname.substr(1)=="referrals"){var campaign="referral_page";}
else if(window.location.pathname.substr(1)=="dream-experiences"){var campaign="dream_experience_share";var product_id=$(this).data('id');}
else{var campaign="share_the_love"}
if(typeof(window.post_id)=="undefined"&&typeof(product_id)=="undefined"){var product_id=$("#product").data("id");}
else if(typeof(window.post_id)!=="undefined"){var product_id=window.post_id;}
$.ajax({url:'/wp-content/themes/omaze/ajax-referral.php',type:'POST',async:false,data:{channel:"twitter",product_id:product_id,campaign:campaign},dataType:'json',success:function(response){$("#sharing-result").html("Thanks for sharing!");$("#sharing-result").addClass("success-message");url=response["url"];text=$('<div/>').html(response["sharing_copy"]).text();},error:function(response){$("#sharing-result").html("We're sorry. Something went wrong. Please try again.");$("#sharing-result").addClass("fail-message");}});via="omaze";width=575;height=400;opts='width='+ width+',height='+ height;window.open("http://twitter.com/intent/tweet?text="+ encodeURIComponent(text)+"&url="+ encodeURIComponent(url)+"&via="+ via,"twitter",opts);mixpanel.track("Social Activity",{"Platform":"Twitter","Action":"Tweet Intent","Campaign":campaign});mixpanel.people.increment("Tweets");}});$("#email-link, .email.social-icon").click(function(event){event.preventDefault();if($(this).hasClass("popup-trigger")){return;}
else{if(window.location.pathname.substr(1)=="thank-you"){var campaign="share_the_love_thankyou";}
else{var campaign="share_the_love"}
email_referral(campaign,window.post_id);}});$('.qa .question').click(function(){$(this).closest('.qa').toggleClass('expanded');});if(typeof($("#new_place_order")!=="undefined")){$("#card-code-tip").tooltip();if($("#cc").length!==0){$("#cc").payment('formatCardNumber');$("#exp-date").payment("formatCardExpiry");$('#card-code').payment('formatCardCVC');$("#cc").keyup(function(){var card_type=$.payment.cardType($("#cc").val());if(card_type){$("#cards li").addClass("off");$("#cards .cc-"+ card_type).removeClass("off");}else{$("#cards li").removeClass("off");}});}
$("#cc-edit").click(function(e){e.preventDefault();$(this).toggle();$("#reset-cc").toggle();$("#cc").attr("disabled",false);$("#cc").removeClass("token");$("#save-cc-text").text("Update payment details");$("label[for='save-cc-info']").slideToggle();$("#use_token").val(0);});$("#reset-cc").click(function(e){e.preventDefault();$(this).toggle();$("#cc-edit").toggle();$("#cc").val($("#cc").prop("defaultValue"));$("#exp-date").val($("#exp-date").prop("defaultValue"));$("#cards li").each(function(){$(this).addClass("off");if($(this).hasClass("default"))$(this).removeClass("off");});$("#cc").addClass("token");$("#cc").attr("disabled",true);$("label[for='save-cc-info']").slideToggle();$("#use_token").val(1);});function show_password(){if($("#save-info").prop("checked")){$("#password-check").slideDown();$("#password").attr("required","");}else{$("#password-check").slideUp();$("#password").attr("required",false);}}
$("#save-info, label[for=save-info], label[for=save-info] > div.checkbox").click(function(e){show_password()});var og_text=$("#new_place_order").html();$("form.omaze-checkout").keydown(function(e){if(e.which===13)$("#new_place_order").click()});$("#new_place_order").click(function(e){if($(this).hasClass("disabled"))return false;var data={};var inputs=$(".omaze-checkout input[data-required], .omaze-checkout input[type=hidden], .omaze-checkout select, #save-cc-info");var loading_text=$(this).data("loading-text");var errors={};var loading_interval;var card_type=$.payment.cardType($("#cc").val());var i=0;var letters=loading_text.split("");var text="";function disable(){$("#new_place_order").addClass("disabled");$("#new_place_order").attr("disabled",true);$("#new_place_order").html(loading_text);$("#errors").html("");$("input.error, label.error").removeClass("error");$("i.bs-icon-exclamation-sign").hide();loading_interval=setInterval(function(){loading();},300);}
disable();function loading(){if(i>(letters.length-1)){i=0;text="";}
var s=letters[i];text+=s;$("#new_place_order").html(text);i++;}
function enable(){$("#new_place_order").removeClass("disabled");$("#new_place_order").attr("disabled",false);$("#new_place_order").html(og_text);if(loading_interval!=undefined){clearInterval(loading_interval);}}
function CheckoutError(message){this.name="Checkout error";this.message=message||"Payment error";}
CheckoutError.prototype=new Error();CheckoutError.prototype.constructor=CheckoutError;function send_error(message,meta_data){var cc=$("#cc").length!==0?$("#cc").val().split(" ").join(""):"free order";var base_data={cc_length:cc.length,bin_num:cc.substr(0,6),email:$("#email").val(),order:order,acct_num:cc.substr(-4),type:card_type};var meta_data=$.extend(base_data,meta_data)||base_data;if(typeof(_errs)!="undefined"){e=new CheckoutError(message);_errs.meta=meta_data;_errs.push(e);throw e.name;}}
function printErrors(errors){var blank=false;var count=0;$.each(errors,function(key,value){var el=$("input[name='"+key+"']");var id=el.attr("id");var l=$("label[for='"+id+"']")
l.prepend("<i class='bs-icon-exclamation-sign'></i> ");el.addClass("error");l.addClass("error");if(value!=="blank"){$("#errors").append("<li><i class='bs-icon-exclamation-sign'></i> "+value+"</li>");}else if(key==="card_type"){$("#errors").prepend("<li><i class='bs-icon-exclamation-sign'></i> We're sorry. We don't recognize this credit card. Please contact support@omaze.com.</li>");send_error("Unrecognized credit card type");}else{blank=true;count++;}});if(blank&&count===1){id=$("input[name='"+Object.keys(errors)[0]+"']").attr("id");label=$("label[for='"+id+"']").text();$("#errors").prepend("<li><i class='bs-icon-exclamation-sign'></i> Please fill out the "+label+" field</li>");}else if(blank){$("#errors").prepend("<li><i class='bs-icon-exclamation-sign'></i> Please fill out the highlighted fields</li>");}}
function checkForPending(user,count){var code=btoa(user);count=(count|0);$.ajax({url:'/wp-content/themes/omaze/ajax-pending-orders.php',type:'POST',data:{code:code},dataType:'json',success:function(response){if(response&&response['redirect']){window.location=decodeURI(response.redirect);}else if(count<3){setTimeout(function(){checkForPending(user,count+1)},5000);}else{$("#new_place_order").hide();$("#errors").html("There was a problem processing your order right now. Please wait a few minutes and check your email for the confirmation. If continue to have problems, contact support@omaze.com.");}},error:function(response){$("#new_place_order").hide();$("#errors").html("We weren't able to process your request. Please try again. If continue to have problems, contact support@omaze.com.");}});}
$("#save-cc-info").val($("#save-cc-info").prop("checked")?1:0);if($("#use_token").val()!=="1"){$("input#card_type").val(card_type);}
inputs.each(function(){var name=$(this).attr("name");var val=$.trim($(this).val());data[name]=val;if(val===""&&name!=="card_type"){errors[name]="blank";}});if($("#save-info").is(":checked")){data["createaccount"]=1;data["account_username"]=$("#billing_email").val();data["account_password"]=$("#password").val();data["account_password-2"]=$("#password").val();}
if(!data["billing_email"].valid_email()&&data["billing_email"]!==""){errors["billing_email"]="Please enter a valid email address."}
if($("#cc").length!==0){var el=$("#cc");var name=el.attr("name");var ccNumValid=$.payment.validateCardNumber($('#cc').val());if(!ccNumValid&&!el.hasClass("token")&&el.val().split(" ").join("")!==el.prop("defaultValue")){errors[name]="Please enter a valid credit card number";}else if($.isEmptyObject(errors)){data[name]=data[name].split(" ").join("");}
var expDate=$("#exp-date").payment("cardExpiryVal");var expDateValid=$.payment.validateCardExpiry(expDate.month,expDate.year)
if(expDateValid){data["litle_expmonth"]=("0"+ expDate.month).slice(-2);data["litle_expyear"]=(""+ expDate.year).slice(-2);}else{errors["exp-date"]="Please enter a valid card expiration date";}}
if($("#save-info").is(":checked")&&$("#password").val()===""){errors["password"]="blank";}
if(!$.isEmptyObject(errors)){enable();printErrors(errors);}else{$.ajax({type:'POST',url:woocommerce_params.checkout_url,data:data,timeout:50000,success:function(code){try{if(code.indexOf("<!--WC_START-->")>=0)
code=code.split("<!--WC_START-->")[1];if(code.indexOf("<!--WC_END-->")>=0)
code=code.split("<!--WC_END-->")[0];var result=$.parseJSON(code);if(result.result=='success'){window.location=decodeURI(result.redirect);}else if(result.result=='check'){checkForPending(data["billing_email"]);}else if(result.result=='failure'){$("#errors").html(result.messages);enable();}else{throw"Invalid response";}}
catch(err){checkForPending(data["billing_email"]);}},error:function(code){checkForPending(data["billing_email"]);},dataType:"html"});}});}
var isMobile=false;function checkIsMobile(){if($(window).width()<745){isMobile=true;}else{isMobile=false;}}
$(window).resize(function(){checkIsMobile();cta_bar();});function cta_bar(){if($("#cta-bar").length>0&&$("div.purchase").length>0&&$("#expr-more").length>0){var a=$(window).scrollTop(),d=$("div.purchase").offset().top+ 20,c=$("#cta-bar"),e=$("#expr-more").offset().top- 400;if(a>d&&a<e&&!isMobile){if(!c.is(":visible")){c.stop().slideDown();}}
else if(c.is(":visible")||isMobile){c.stop().slideUp();}}}
$(window).scroll(function(){cta_bar()});$(window).load(function(){cta_bar()});});(function($){$.fn.val=(function(original){return function(){var args=[].slice.call(arguments,0);return!arguments.length&&$(this[0]).is('input:text[data-placeholder].with-placeholder,textarea[data-placeholder].with-placeholder')?'':original.apply(this,args);};})($.fn.val);})(jQuery);